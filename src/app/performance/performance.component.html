<div class="style-preferences-container">
  <!-- Sidebar -->
  <div class="preferences-sidebar">
    <app-sidebare></app-sidebare>
  </div>



  <!-- Main Form -->
 <div *ngIf="!showCardAfterSubmit" class="style-form-wrapper">
    <form [formGroup]="preferenceForm" (ngSubmit)="onSubmit()" class="preference-form">

      <!-- Style Section -->
      <div class="form-section">
        <h3 class="section-title">
          <span class="section-icon"></span>
          Style vestimentaire habituel
        </h3>
        <div class="style-grid">
          <div *ngFor="let style of styleOptions"
               class="style-card"
               [class.selected]="preferenceForm.get('styleVestimentaire')?.value === style.value"
               (click)="selectStyle(style.value)">
            <div class="style-icon">{{style.icon}}</div>
            <div class="style-name">{{style.label}}</div>
          </div>
        </div>
      </div>

      <!-- Preferences Section -->
      <div class="form-section">
        <h3 class="section-title">
          <span class="section-icon"></span>
          Pr√©f√©rences additionnelles
        </h3>
        <div class="preferences-grid">
          <div *ngFor="let pref of preferenceOptions"
               class="preference-tag"
               [class.selected]="isPreferenceSelected(pref.value)"
               (click)="togglePreference(pref.value)">
            <span class="pref-icon">{{pref.icon}}</span>
            {{pref.label}}
          </div>
        </div>
      </div>

      <!-- Colors Section -->
      <div class="form-section">
        <h3 class="section-title">
          <span class="section-icon"></span>
          Couleurs favorites
        </h3>
        <div class="colors-grid">
          <div *ngFor="let color of colorOptions"
               class="color-option"
               [class.selected]="isColorSelected(color.value)"
               (click)="toggleColor(color.value)">
            <div class="color-circle" [style.background-color]="color.hex"></div>
            <span class="color-name">{{color.label}}</span>
          </div>
        </div>
      </div>

      <!-- Size and Budget -->
      <div class="form-section">
        <div class="row-inputs">
          <div class="input-group half-width">
            <label for="taille">Taille</label>
            <select id="taille" formControlName="taille" class="modern-select">
              <option value="">S√©lectionner</option>
              <option value="XS">XS</option>
              <option value="S">S</option>
              <option value="M">M</option>
              <option value="L">L</option>
              <option value="XL">XL</option>
              <option value="XXL">XXL</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Notification Section -->
      <div class="form-section">
        <h3 class="section-title">
          <span class="section-icon"></span>
          Minute de style quotidienne
        </h3>
        <div class="notification-controls">
          <div class="notification-toggle">
            <input
              type="checkbox"
              id="notifications"
              formControlName="notificationsActivees"
              class="toggle-checkbox"
            >
            <label for="notifications" class="toggle-label">
              <span class="toggle-slider"></span>
              Activer les notifications
            </label>
          </div>

          <div *ngIf="preferenceForm.get('notificationsActivees')?.value"
               class="time-selector">
            <label for="heureNotification">Heure de notification</label>
            <input
              id="heureNotification"
              type="time"
              formControlName="heureNotification"
              class="modern-input time-input"
            >
          </div>
        </div>
      </div>

      <!-- Submit Button -->
      <div class="submit-section">
        <button
          type="submit"
          class="submit-btn"
          [disabled]="preferenceForm.invalid || isLoading"
          [class.loading]="isLoading">
          <span *ngIf="!isLoading" class="btn-content">
            <span class="btn-icon">üí´</span>
            Sauvegarder mes pr√©f√©rences
          </span>
          <span *ngIf="isLoading" class="loading-spinner"></span>
        </button>

        <button
          type="button"
          class="delete-btn"
          [disabled]="isLoading"
          (click)="deletePreferences()">
          <span class="btn-content">
            <span class="btn-icon">üóëÔ∏è</span>
            Supprimer mes pr√©f√©rences
          </span>
        </button>
      </div>

    </form>


  </div>
  <!-- EN DEHORS de style-form-wrapper -->
<div *ngIf="showCardAfterSubmit && savedPreferences" class="recap-wrapper">
  <div class="preference-card centered-recap-card">
    <h2 class="recap-title">üßæ R√©capitulatif de vos pr√©f√©rences</h2>

    <div class="recap-row">
      <span class="recap-label">Style vestimentaire :</span>
      <span class="recap-value">{{ savedPreferences.styleVestimentaire }}</span>
    </div>
    <!-- Groupe de pr√©f√©rences -->
<div class="recap-group" *ngIf="savedPreferences?.otherPreferences as prefs">

  <!-- Pr√©f√©rences -->
  <div class="recap-row" *ngIf="prefs[0]">
    <span class="recap-label">Pr√©f√©rences :</span>
    <span class="recap-value">
      <ng-container *ngFor="let item of prefs[0].split(',')">
        <span class="recap-badge">{{ item }}-</span>
      </ng-container>
    </span>
  </div>

  <!-- Couleurs favorites -->
  <div class="recap-row" *ngIf="prefs[1]">
    <span class="recap-label">Couleurs favorites :</span>
    <span class="recap-value">
      <ng-container *ngFor="let color of prefs[1].split(',')">
        <span class="recap-badge color-badge">{{ color }}-</span>
      </ng-container>
    </span>
  </div>

  <!-- Taille -->
  <div class="recap-row" *ngIf="prefs[2]">
    <span class="recap-label">Taille :</span>
    <span class="recap-value">{{ prefs[2] }}</span>
  </div>

  <!-- Budget -->
  <div class="recap-row" *ngIf="prefs[3]">
    <span class="recap-label">Budget :</span>
    <span class="recap-value">{{ prefs[3] }}</span>
  </div>

  <!-- Occasions -->
  <div class="recap-row" *ngIf="prefs[4]">
    <span class="recap-label">Occasions fr√©quentes :</span>
    <span class="recap-value">
      <ng-container *ngFor="let occasion of prefs[4].split(',')">
        <span class="recap-badge">{{ occasion }}</span>
      </ng-container>
    </span>
  </div>

</div>






    <div class="recap-row" *ngIf="savedPreferences.notificationTime">
      <span class="recap-label">Heure de notification :</span>
      <span class="recap-value">{{ savedPreferences.notificationTime }}</span>
    </div>

    <div class="recap-row">
      <span class="recap-label">Notifications activ√©es :</span>
      <span class="recap-value">{{ savedPreferences.notificationsActivees ? 'Oui' : 'Non' }}</span>
    </div>

    <div class="recap-actions">
      <button class="submit-btn" (click)="editPreferences()">üîÑ Modifier mes pr√©f√©rences</button>
    </div>
  </div>
</div>




  <!-- Success Message -->
  <div *ngIf="showSuccess" class="success-message">
    <div class="success-content">
      <span class="success-icon">‚úÖ</span>
      Pr√©f√©rences sauvegard√©es avec succ√®s !
    </div>
  </div>

  <!-- Error Message -->
  <div *ngIf="showError" class="error-message-global">
    <div class="error-content">
      <span class="error-icon">‚ùå</span>
      {{errorMessage}}
    </div>
  </div>


</div>
