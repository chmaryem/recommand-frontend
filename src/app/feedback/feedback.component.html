<div class="page-layout">
  <div class="sidebar-section">
    <app-sidebare></app-sidebare>
  </div>

  <main class="main-section">
    <div class="feedback-container">
      <div class="recommendation-image-container" *ngIf="image">
        <img [src]="image" alt="Tenue recommandée" class="recommendation-image" />
      </div>

      <div class="feedback-header">
        <h3 class="feedback-title">
          <span class="feedback-icon">💭</span>
          Votre avis sur cette tenue
        </h3>
        <p class="feedback-subtitle">Aidez-nous à personnaliser vos recommandations</p>
      </div>

      <div class="outfit-preview">
        <div class="outfit-items">
          <div *ngFor="let item of outfitItems" class="outfit-item">
            <div class="item-icon" [class]="'item-' + item.type">
              <ng-container [ngSwitch]="item.type">
                <span *ngSwitchCase="'tshirt'">👕</span>
                <span *ngSwitchCase="'jean'">👖</span>
                <span *ngSwitchCase="'baskets'">👟</span>
                <span *ngSwitchCase="'blouse'">👚</span>
                <span *ngSwitchCase="'short'">🩳</span>
                <span *ngSwitchCase="'sandales'">👡</span>
                <span *ngSwitchDefault>👔</span>
              </ng-container>
            </div>
            <span class="item-name">{{ item.name }}</span>
            <span class="item-color">{{ item.color }}</span>
          </div>
        </div>
        <div class="style-badge" [class]="'style-' + style">
          {{ style === 'sunny' ? 'Look Ensoleillé' : 'Alternative Chic' }}
        </div>
      </div>

      <div class="error-message" *ngIf="errorMessage">{{ errorMessage }}</div>

      <div class="feedback-main" *ngIf="!showDetailedFeedback && !showConfirmation">
        <div class="feedback-buttons">
          <button
            class="feedback-btn like-btn"
            [class.active]="liked === true"
            (click)="setLike(true)"
            type="button">
            <span class="btn-icon">👍</span>
            <span class="btn-text">J'aime</span>
          </button>
          <button
            class="feedback-btn dislike-btn"
            [class.active]="liked === false"
            (click)="setLike(false)"
            type="button">
            <span class="btn-icon">👎</span>
            <span class="btn-text">Je n'aime pas</span>
          </button>
        </div>
        <button class="skip-btn" (click)="skipFeedback()" type="button">
          Passer
        </button>
      </div>

      <div class="feedback-detailed" *ngIf="showDetailedFeedback && !showConfirmation">
        <div class="rating-section">
          <label class="section-label">Votre note :</label>
          <div class="stars-container">
            <button
              *ngFor="let star of [1,2,3,4,5]; let i = index"
              class="star-btn"
              [class.filled]="i < rating"
              (click)="setRating(i + 1)"
              type="button">
              ⭐
            </button>
          </div>
          <div class="rating-display" *ngIf="rating > 0">
            Note sélectionnée : {{ rating }}/5
          </div>
        </div>

        <div class="tags-section">
          <label class="section-label">
            {{ liked ? 'Points forts :' : 'Points à améliorer :' }}
          </label>
          <div class="tags-grid">
            <button
              *ngFor="let tag of getFilteredTags()"
              class="tag-btn"
              [class.selected]="isTagSelected(tag.id)"
              (click)="toggleTag(tag.id)"
              type="button">
              <span class="tag-icon">{{ tag.icon }}</span>
              <span class="tag-label">{{ tag.label }}</span>
            </button>
          </div>
        </div>

        <div class="comment-section">
          <label class="section-label" for="comment">Commentaire :</label>
          <textarea
            id="comment"
            class="comment-input"
            [(ngModel)]="comment"
            placeholder="Dites-nous ce que vous pensez de cette tenue..."
            rows="4"
            maxlength="200">
          </textarea>
          <div class="char-count">{{ comment.length }}/200</div>
        </div>

        <div class="action-buttons">
          <button class="btn-secondary" (click)="resetFeedback()" type="button">
            Annuler
          </button>
          <button class="btn-primary" (click)="submitFeedback()" type="button">
            <span class="btn-icon">📤</span>
            Envoyer
          </button>
        </div>
      </div>

      <div class="feedback-confirmation" *ngIf="showConfirmation">
        <div class="confirmation-content">
          <span class="confirmation-icon">✅</span>
          <h4>Merci pour votre feedback !</h4>
          <p>Votre note : {{ submittedRating }}/5</p>
          <p class="confirmation-text">Vos commentaires nous aident à améliorer nos recommandations.</p>
          <button class="btn-primary" (click)="closeConfirmation()" type="button">
            Retour au dashboard
          </button>
        </div>
      </div>
    </div>
  </main>
</div>
