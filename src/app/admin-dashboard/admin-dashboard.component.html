<!-- admin-dashboard.component.html -->
<div class="admin-dashboard">
  <!-- Header -->
  <div class="header">
    <div class="header-content">
      <div class="header-left">
        <h1>Dashboard Admin</h1>
        <p>Gestion des recommandations d'outfits</p>
      </div>
      <div class="header-right">
        <select [(ngModel)]="filterPeriod" class="filter-select">
          <option value="1d">Dernières 24h</option>
          <option value="7d">7 derniers jours</option>
          <option value="30d">30 derniers jours</option>
          <option value="90d">3 derniers mois</option>
        </select>
        <button class="export-btn" (click)="exportData()">
          <i class="icon-download"></i>
          Exporter
        </button>
      </div>
    </div>
  </div>

  <!-- Navigation -->
  <div class="nav-container">
    <div class="nav-tabs">
      <button
        *ngFor="let tab of ['overview', 'recommendations', 'analytics']"
        (click)="setActiveTab(tab)"
        [class.active]="activeTab === tab"
        class="nav-tab"
      >
        {{ tab === 'overview' ? 'Vue d\'ensemble' :
           tab === 'recommendations' ? 'Historique' : 'Analyses' }}
      </button>
    </div>
  </div>

  <!-- Content -->
  <div class="content">
    <!-- Overview Tab -->
    <div *ngIf="activeTab === 'overview'" class="tab-content">
      <!-- Stats Cards -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-content">
            <div class="stat-text">
              <p class="stat-label">Recommandations totales</p>
              <p class="stat-value">{{ dashboardStats.totalRecommendations | number }}</p>
              <p class="stat-change positive">+12.5% vs période précédente</p>
            </div>
            <div class="stat-icon blue">
              <i class="icon-eye"></i>
            </div>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-content">
            <div class="stat-text">
              <p class="stat-label">Utilisateurs actifs</p>
              <p class="stat-value">{{ dashboardStats.activeUsers | number }}</p>
              <p class="stat-change positive">+8.2% vs période précédente</p>
            </div>
            <div class="stat-icon green">
              <i class="icon-users"></i>
            </div>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-content">
            <div class="stat-text">
              <p class="stat-label">Note moyenne</p>
              <p class="stat-value">{{ dashboardStats.avgRating }}</p>
              <p class="stat-change positive">+3.1% vs période précédente</p>
            </div>
            <div class="stat-icon yellow">
              <i class="icon-star"></i>
            </div>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-content">
            <div class="stat-text">
              <p class="stat-label">Taux de satisfaction</p>
              <p class="stat-value">{{ dashboardStats.conversionRate }}%</p>
              <p class="stat-change negative">-2.3% vs période précédente</p>
            </div>
            <div class="stat-icon purple">
              <i class="icon-trending-up"></i>
            </div>
          </div>
        </div>
      </div>

      <!-- Charts -->
      <div class="charts-grid">
        <!-- Emotions Chart -->
        <div class="chart-card">
          <h3>Répartition par émotion</h3>
          <div class="chart-content">
            <div *ngFor="let emotion of emotionStats | keyvalue" class="chart-row">
              <div class="chart-label">
                <span [class]="getEmotionColor(emotion.key)" class="emotion-badge">
                  {{ emotion.key }}
                </span>
              </div>
              <div class="chart-bar-container">
                <div class="chart-bar">
                  <div
                    class="chart-bar-fill blue"
                    [style.width.%]="getEmotionPercentage(emotion.value)"
                  ></div>
                </div>
                <span class="chart-percentage">{{ emotion.value }}%</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Weather Chart -->
        <div class="chart-card">
          <h3>Répartition par météo</h3>
          <div class="chart-content">
            <div *ngFor="let weather of weatherStats | keyvalue" class="chart-row">
              <div class="chart-label">
                <span class="weather-icon">{{ getWeatherIcon(weather.key) }}</span>
                <span class="weather-label">{{ weather.key }}</span>
              </div>
              <div class="chart-bar-container">
                <div class="chart-bar">
                  <div
                    class="chart-bar-fill green"
                    [style.width.%]="getWeatherPercentage(weather.value)"
                  ></div>
                </div>
                <span class="chart-percentage">{{ weather.value }}%</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Recommendations Tab -->
    <div *ngIf="activeTab === 'recommendations'" class="tab-content">
      <!-- Filters -->
      <div class="filters-card">
        <div class="filters-content">
          <i class="icon-filter"></i>
          <label>Filtrer par émotion:</label>
          <select [(ngModel)]="selectedEmotion" class="emotion-filter">
            <option value="all">Toutes les émotions</option>
            <option *ngFor="let emotion of emotions.slice(1)" [value]="emotion">
              {{ emotion }}
            </option>
          </select>
        </div>
      </div>

      <!-- Recommendations Table -->
      <div class="table-card">
        <div class="table-header">
          <h3>Historique des recommandations</h3>
          <p class="table-count">{{ filteredRecommendations.length }} recommandations</p>
        </div>
        <div class="table-container">
          <table class="recommendations-table">
            <thead>
              <tr>
                <th>Utilisateur</th>
                <th>Émotion</th>
                <th>Météo</th>
                <th>Température</th>
                <th>Lieu</th>
                <th>Outfit recommandé</th>
                <th>Note</th>
                <th>Feedback</th>
                <th>Date</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let rec of filteredRecommendations">
                <td>
                  <div class="user-cell">
                    <div class="user-avatar">{{ rec.user.charAt(0) }}</div>
                    <span>{{ rec.user }}</span>
                  </div>
                </td>
                <td>
                  <span [class]="getEmotionColor(rec.emotion)" class="emotion-badge">
                    {{ rec.emotion }}
                  </span>
                </td>
                <td>
                  <div class="weather-cell">
                    <span class="weather-icon">{{ getWeatherIcon(rec.weather) }}</span>
                    <span>{{ rec.weather }}</span>
                  </div>
                </td>
                <td>{{ rec.temperature }}°C</td>
                <td>{{ rec.location }}</td>
                <td class="outfit-cell">{{ rec.outfit }}</td>
                <td>
                  <div class="rating-cell">
                    <span
                      *ngFor="let star of getStarArray(rec.rating)"
                      [class]="star ? 'star-filled' : 'star-empty'"
                      class="star"
                    >★</span>
                  </div>
                </td>
                <td class="feedback-cell">{{ rec.feedback }}</td>
                <td class="timestamp-cell">{{ rec.timestamp }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Analytics Tab -->
    <div *ngIf="activeTab === 'analytics'" class="tab-content">
      <div class="analytics-grid">
        <div class="analytics-card">
          <h3>Tendances des émotions</h3>
          <p>Analyse des émotions les plus fréquentes par période</p>
          <div class="analytics-placeholder">
            <i class="icon-chart"></i>
            <p>Graphique des tendances émotionnelles</p>
          </div>
        </div>

        <div class="analytics-card">
          <h3>Performance par météo</h3>
          <p>Corrélation entre conditions météo et satisfaction</p>
          <div class="analytics-placeholder">
            <i class="icon-weather"></i>
            <p>Analyse météorologique</p>
          </div>
        </div>

        <div class="analytics-card">
          <h3>Satisfaction utilisateurs</h3>
          <p>Évolution des notes et feedbacks dans le temps</p>
          <div class="analytics-placeholder">
            <i class="icon-heart"></i>
            <p>Graphique de satisfaction</p>
          </div>
        </div>

        <div class="analytics-card">
          <h3>Géolocalisation</h3>
          <p>Répartition des recommandations par région</p>
          <div class="analytics-placeholder">
            <i class="icon-map"></i>
            <p>Carte des utilisations</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
