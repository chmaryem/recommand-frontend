<div class="mf-container">
  <div class="mf-sidebar">
    <app-sidebare></app-sidebare>
  </div>

  <div class="mf-header">
    <div class="mf-header-left">
      <h1>Bonjour, {{ user.firstName }}!</h1>
      <p>D√©couvrez votre style du jour en analysant votre humeur</p>
    </div>
   <div class="mf-header-right">
  <app-weather></app-weather>
  <div class="mf-user-profile" (click)="toggleUserMenu($event)" #userMenuTrigger>
    <div class="mf-user-avatar">{{ user.initials }}</div>
    <div class="mf-user-details">
      <h4>{{ user.name }}</h4>
      <p>{{ user.status }}</p>
    </div>
    <div class="mf-user-menu" *ngIf="showUserMenu">
      <a routerLink="/settings" aria-label="Ouvrir les param√®tres">Param√®tres</a>
      <a (click)="logout()" aria-label="Se d√©connexion">D√©connexion</a>
    </div>
  </div>
</div>
  </div>

  <div class="mf-main-content">
    <div class="mf-dashboard-grid">
      <div class="mf-mood-section">
        <div class="mf-section-header">
          <span class="mf-section-icon"></span>
          <h2 class="mf-section-title"></h2>
        </div>

        <div class="mf-mood-capture-area" [class.mf-analyzing]="isAnalyzing" (click)="toggleCaptureOptions()" *ngIf="!moodAnalyzed">
          <ng-container *ngIf="!isAnalyzing">
            <div class="mf-capture-icon">üì∏</div>
            <div class="mf-capture-title">Capturez votre humeur</div>
            <div class="mf-capture-subtitle">Utilisez votre webcam ou uploadez une photo</div>
            <div class="mf-capture-buttons" *ngIf="showCaptureButtons">
              <button class="mf-btn mf-btn-secondary" (click)="openCamera($event)" aria-label="Ouvrir la webcam">
                <span>üì∑</span> Webcam
              </button>
              <button class="mf-btn mf-btn-secondary" (click)="uploadPhoto($event)" aria-label="T√©l√©charger une photo">
                <span>üìÅ</span> Upload
              </button>
            </div>
          </ng-container>
          <ng-container *ngIf="isAnalyzing">
            <div class="mf-loading"></div>
            <div class="mf-capture-title">Analyse en cours...</div>
            <div class="mf-capture-subtitle">D√©tection de votre humeur</div>
          </ng-container>
          <video #cameraPreview class="mf-camera-preview"></video>
        </div>

        <div class="mf-current-mood-display" *ngIf="moodAnalyzed">
          <div class="mf-mood-result-container">
            <div class="mf-captured-image-container" *ngIf="capturedImageUrl">
              <img [src]="capturedImageUrl" alt="Image captur√©e" class="mf-captured-image">
              <div class="mf-image-overlay">
                <button class="mf-retake-btn" (click)="retakePhoto()" aria-label="Prendre une nouvelle photo">
                  <span>üîÑ</span> Nouvelle photo
                </button>
              </div>
            </div>
            <div class="mf-mood-analysis-result">
              <div class="mf-mood-emoji">{{ currentMood.emoji }}</div>
              <div class="mf-mood-text">{{ currentMood.text }}</div>
              <div class="mf-mood-confidence">
                <span class="mf-confidence-label">Confiance:</span>
                <div class="mf-confidence-bar">
                  <div class="mf-confidence-fill" [style.width.%]="currentMood.confidence"></div>
                </div>
                <span class="mf-confidence-value">{{ currentMood.confidence }}%</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="mf-stats-section" *ngIf="barChartData">
        <div class="mf-section-header">
          <span class="mf-section-icon"></span>
          <h2 class="mf-section-title"></h2>
          <button class="mf-refresh-btn" (click)="refreshStatistics()" aria-label="Rafra√Æchir les statistiques"></button>
        </div>
        <div class="mf-stats-chart">
          <canvas baseChart [data]="barChartData.data" [type]="barChartData.type" [options]="barChartData.options"></canvas>
        </div>
        <div class="mf-stats-grid">
          <div class="mf-stat-card" *ngFor="let stat of statistics">
            <div class="mf-stat-value">{{ stat.value }}</div>
            <div class="mf-stat-label">{{ stat.label }}</div>
          </div>
        </div>
      </div>

      <div class="mf-outfit-section">
        <div class="mf-section-header">
          <span class="mf-section-icon"></span>
          <h2 class="mf-section-title"></h2>
        </div>

        <div class="mf-outfit-card" *ngFor="let outfit of outfitRecommendations; let i = index">
          <div class="mf-outfit-header">
            <div class="mf-outfit-title">{{ outfit.title }}</div>
            <div class="mf-outfit-score">{{ outfit.score }}% Match</div>
          </div>

          <div class="mf-outfit-items">
            <div class="mf-outfit-item" *ngFor="let item of outfit.items">
              <div class="mf-outfit-item-icon">{{ item.icon }}</div>
              <div class="mf-outfit-item-name">{{ item.name }}</div>
              <div class="mf-outfit-item-desc">{{ item.description }}</div>
            </div>
          </div>
          <!-- Ajoutez cette nouvelle section apr√®s la section mf-outfit-section dans votre template HTML -->

<div class="mf-feedback-section" *ngIf="latestFeedback">
  <div class="mf-section-header">
    <span class="mf-section-icon">üí¨</span>
    <h2 class="mf-section-title">Dernier Feedback</h2>
  </div>

  <div class="mf-feedback-card">
    <div class="mf-feedback-header">
      <div class="mf-feedback-title">Votre dernier avis</div>
      <div class="mf-feedback-date">{{ formatDate(latestFeedback.timestamp) }}</div>
    </div>

    <div class="mf-feedback-content">
      <!-- Note avec √©toiles -->
      <div class="mf-rating-display">
        <span class="mf-feedback-label">Note :</span>
        <span class="mf-stars">
          <ng-container *ngFor="let star of [1,2,3,4,5]">
            <span [ngClass]="{ 'star-filled': star <= latestFeedback.rating, 'star-empty': star > latestFeedback.rating }">‚òÖ</span>
          </ng-container>
        </span>
        <span class="mf-score-number">({{ latestFeedback.rating }}/5)</span>
      </div>

      <!-- Commentaire si disponible -->
      <div class="mf-feedback-comment" *ngIf="latestFeedback.comment && latestFeedback.comment.trim() !== ''">
        <span class="mf-feedback-label">Commentaire :</span>
        <p>{{ latestFeedback.comment }}</p>
      </div>

      <!-- Informations sur la recommandation associ√©e -->
      <div class="mf-feedback-recommendation-info" *ngIf="latestFeedback.recommendation">
        <span class="mf-feedback-label">Tenue √©valu√©e :</span>
        <div class="mf-recommendation-summary">
          <span class="mf-recommendation-emotion">{{ getEmoji(latestFeedback.recommendation.emotion) }} {{ latestFeedback.recommendation.emotion }}</span>
          <span class="mf-recommendation-weather">üå§Ô∏è {{ latestFeedback.recommendation.weather }}</span>
        </div>
      </div>
    </div>
  </div>
</div>

          <div class="mf-feedback-action">
            <button
              class="mf-btn mf-feedback-detail-btn"
              *ngIf="!outfit.score || outfit.score > 5"
              (click)="openFeedbackPage(i)"
              aria-label="Donner un feedback">
              Donner un feedback
            </button>

            <div *ngIf="outfit.score && outfit.score <= 5" class="mf-rating-display">
              <span class="mf-feedback-label">Note utilisateur :</span>
              <span class="mf-stars">
                <ng-container *ngFor="let star of [1,2,3,4,5]">
                  <span [ngClass]="{ 'star-filled': star <= outfit.score, 'star-empty': star > outfit.score }">‚òÖ</span>
                </ng-container>
              </span>
              <span class="mf-score-number">({{ outfit.score }}/5)</span>
            </div>
          </div>
        </div>
      </div>

      <div class="mf-actions-section">
        <div class="mf-section-header">
          <span class="mf-section-icon"></span>
          <h2 class="mf-section-title"></h2>
        </div>

        <div class="mf-quick-actions">
          <div class="mf-action-card" *ngFor="let action of quickActions; let i = index" (click)="onActionClick(i)">
            <div class="mf-action-icon">{{ action.icon }}</div>
            <div class="mf-action-title">{{ action.title }}</div>
            <div class="mf-action-desc">{{ action.description }}</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


<div class="mf-notification-toast" [class.mf-show]="showToast">
  {{ showToastMessage }}
</div>
